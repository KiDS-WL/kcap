[DEFAULT]
CSL_PATH = .
KCAP_PATH = .
RUN_NAME = no_baryons_fixed_HMx

[runtime]
sampler = multinest

[multinest]
;wrapped_params = cosmological_parameters--omega_b   cosmological_parameters--h0
max_iterations=50000
multinest_outfile_root=examples/output_kv450/multinest_%(RUN_NAME)s_
resume=F
; from Joe:- For a quick run:
live_points=250
efficiency=0.8
tolerance=0.1
constant_efficiency=F
;    ~ 140k evaluations
;    ~ 9k independent samples
;    Few enough samples that the plots will be too scrappy to use in publications. 
;    Estimated mean and covmat will still be good to a few percent
;    Evidence will be a bit off compared to other estimates.
;- Suggested standard run:
;live_points=500
;efficiency=0.3
;tolerance=0.1
;constant_efficiency=F
;    ~ 350k evaluations
;    ~ 20k independent samples
;    Plots should be fine with some small smoothing or Schuhman's transformation.
;    Reasonable evidence
;- A mega-run:
;live_points=1000
;efficiency=0.05
;tolerance=0.1   
;constant_efficiency=T
;    ~ 1M evaluations
;    ~ 40k independent samples
;    Switching on constant_efficiency speeds up from ~1M samples to ~600k
;    Should only need one or two of these for comparison.


[emcee]
; The emcee sampler uses the concept of walkers, a collection
; ; of live points.  Sampling is done along lines that connect
; ; pairs of walkers.  The number of walkers must be at least
; ; 2*nparam + 1, but in general more than that usually works
; ; better.
burn=0.3
walkers = 32
; ; This many samples is overkill, just to make the plots
; ; look a lot nicer
samples = 10000
;;1000000
; ; This is the interval at which convergence diagnostics
; ; are performed
nsteps = 1
;

[test]
save_dir=examples/output_kv450/kv450_output_fixed_hmx
fatal_errors=T

[output]
filename=examples/output_kv450/kv450_%(RUN_NAME)s.txt
format=text

[pipeline]
;no sys
;modules = consistency sample_ln_As camb halofit_takahashi extrapolate_power load_nz projection cl2xi derived_parameters mini_2pt_like
;w/ linear aligment
;modules = consistency sample_ln_As camb halofit_takahashi extrapolate_power load_nz linear_alignment projection add_intrinsic cl2xi derived_parameters mini_2pt_like
;w/ z shifts
modules = consistency sample_ln_As camb HMx extrapolate_power load_nz source_photoz_bias linear_alignment projection add_intrinsic cl2xi derived_parameters mini_2pt_like

values = examples/KV450_values_no_baryons.ini
priors = examples/KV450_priors.ini

likelihoods = mini_2pt_like
extra_output = cosmological_parameters/omega_m cosmological_parameters/sigma_8 cosmological_parameters/S8
quiet=F
timing=T
debug=F

[consistency]
file = %(CSL_PATH)s/cosmosis-standard-library/utility/consistency/consistency_interface.py

[sample_ln_As]
file = %(KCAP_PATH)s/utils/sample_ln_As.py

[derived_parameters]
file = %(KCAP_PATH)s/utils/derived_parameters.py
parameters = S8

[camb]
file = %(CSL_PATH)s/cosmosis-standard-library/boltzmann/camb/camb.so
mode=all
lmax=2500
;accuracy_boost = 2.0
;high_accuracy_default = T
feedback=0
kmin=1e-5
kmax=10.0
nk=200
zmax=6.0
zmin=0.0
;nz=2
background_zmax=6.0
background_zmin=0.0
background_nz=150

[halofit_takahashi]
file = %(CSL_PATH)s/cosmosis-standard-library/boltzmann/halofit_takahashi/halofit_interface.so

[HMx]
file = %(KCAP_PATH)s/HMx/lib/cosmosis_interface.so
nk = 128
kmin = 1e-5
kmax = 1e2
nz = 64
zmin = 0.0
zmax = 5.99
verbose = 0
dimensionless_power_spectrum = 0
p_lin_source = external
hm_mode = hmcode
one_parameter_hmcode = T

[sigma8_rescale]
file = %(CSL_PATH)s/cosmosis-standard-library/utility/sample_sigma8/sigma8_rescale.py

[load_nz]
file = %(CSL_PATH)s/cosmosis-standard-library/number_density/load_nz/load_nz.py
filepath = %(CSL_PATH)s/examples/kv450_data/nofz/A/Nz_DIR_z0.1t0.3.asc %(CSL_PATH)s/examples/kv450_data/nofz/A/Nz_DIR_z0.3t0.5.asc %(CSL_PATH)s/examples/kv450_data/nofz/A/Nz_DIR_z0.5t0.7.asc %(CSL_PATH)s/examples/kv450_data/nofz/A/Nz_DIR_z0.7t0.9.asc %(CSL_PATH)s/examples/kv450_data/nofz/A/Nz_DIR_z0.9t1.2.asc
;filepath = %(CSL_PATH)s/examples/kv450_data/nofz/B/Nz_DIR_z0.1t0.3.asc %(CSL_PATH)s/examples/kv450_data/nofz/B/Nz_DIR_z0.3t0.5.asc %(CSL_PATH)s/examples/kv450_data/nofz/B/Nz_DIR_z0.5t0.7.asc %(CSL_PATH)s/examples/kv450_data/nofz/B/Nz_DIR_z0.7t0.9.asc %(CSL_PATH)s/examples/kv450_data/nofz/B/Nz_DIR_z0.9t1.2.asc
histogram = True
output_section = nz_KV450_5bin

[source_photoz_bias]
file = %(CSL_PATH)s/cosmosis-standard-library/number_density/photoz_bias/photoz_bias.py
mode = additive
sample = nz_KV450_5bin
bias_section = nofz_shifts
interpolation = linear

[linear_alignment]
file = %(CSL_PATH)s/cosmosis-standard-library/intrinsic_alignments/la_model/linear_alignments_interface.py
method = bk_corrected

[projection]
file = %(CSL_PATH)s/cosmosis-standard-library/structure/projection/project_2d.py
ell_min = 0.1
ell_max = 5.0e5
n_ell = 400
shear-shear = KV450_5bin-KV450_5bin 
shear-intrinsic = KV450_5bin-KV450_5bin
intrinsic-intrinsic = KV450_5bin-KV450_5bin
;position-shear = sample-sample
verbose = T
get_kernel_peaks = F


[add_intrinsic]
file=%(CSL_PATH)s/cosmosis-standard-library/shear/add_intrinsic/add_intrinsic.py
position-shear=False

;This Nicaea code converts C_ell into xi(theta).
;It is fast and accurate but requires a high ell_max, as shown above
[cl2xi]
file = %(CSL_PATH)s/cosmosis-standard-library/shear/cl_to_xi_nicaea/nicaea_interface.so
corr_type = 0


;[2pt_like]
;file = %(CSL_PATH)s/cosmosis-standard-library/likelihood/2pt/2pt_like.py
;data_file=%(CSL_PATH)s/cosmosis-standard-library/likelihood/cfhtlens/cfhtlens_heymans13.fits
;gaussian_covariance=F
;covmat_name=COVMAT
;covariance_realizations = 1656
;like_name=cfhtlens

;data_sets=all
;data_sets = xi_plus xi_minus

[extrapolate_power]
file=%(CSL_PATH)s/cosmosis-standard-library/boltzmann/extrapolate/extrapolate_power.py
kmax=500.0

[mini_2pt_like]
file = %(KCAP_PATH)s/utils/mini_2pt_like.py
n_bin = 5
data_filename = %(KCAP_PATH)s/examples/kv450_data/data_vector/KV450_reweight_3x4x4_v2_good_xipm_mcor_5bin.dat
cut_xi_plus = 7 8
cut_xi_minus = 0 1 2
order_cov = montepython
order_data = montepython
;bin_1_1 = %(KCAP_PATH)s/examples/kv450_data/data_vector/TC_KV450_GALL_reweight_3x3x3_v2_good_xi_e1cor_e2cor_A_tomo_1_1_logbin.dat
;bin_2_1 = %(KCAP_PATH)s/examples/kv450_data/data_vector/TC_KV450_GALL_reweight_3x3x3_v2_good_xi_e1cor_e2cor_A_tomo_1_2_logbin.dat
;bin_2_2 = %(KCAP_PATH)s/examples/kv450_data/data_vector/TC_KV450_GALL_reweight_3x3x3_v2_good_xi_e1cor_e2cor_A_tomo_2_2_logbin.dat
;bin_3_1 = %(KCAP_PATH)s/examples/kv450_data/data_vector/TC_KV450_GALL_reweight_3x3x3_v2_good_xi_e1cor_e2cor_A_tomo_1_3_logbin.dat
;bin_3_2 = %(KCAP_PATH)s/examples/kv450_data/data_vector/TC_KV450_GALL_reweight_3x3x3_v2_good_xi_e1cor_e2cor_A_tomo_2_3_logbin.dat
;bin_3_3 = %(KCAP_PATH)s/examples/kv450_data/data_vector/TC_KV450_GALL_reweight_3x3x3_v2_good_xi_e1cor_e2cor_A_tomo_3_3_logbin.dat
;bin_4_1 = %(KCAP_PATH)s/examples/kv450_data/data_vector/TC_KV450_GALL_reweight_3x3x3_v2_good_xi_e1cor_e2cor_A_tomo_1_4_logbin.dat
;bin_4_2 = %(KCAP_PATH)s/examples/kv450_data/data_vector/TC_KV450_GALL_reweight_3x3x3_v2_good_xi_e1cor_e2cor_A_tomo_2_4_logbin.dat
;bin_4_3 = %(KCAP_PATH)s/examples/kv450_data/data_vector/TC_KV450_GALL_reweight_3x3x3_v2_good_xi_e1cor_e2cor_A_tomo_3_4_logbin.dat
;bin_4_4 = %(KCAP_PATH)s/examples/kv450_data/data_vector/TC_KV450_GALL_reweight_3x3x3_v2_good_xi_e1cor_e2cor_A_tomo_4_4_logbin.dat
;bin_5_1 = %(KCAP_PATH)s/examples/kv450_data/data_vector/TC_KV450_GALL_reweight_3x3x3_v2_good_xi_e1cor_e2cor_A_tomo_1_5_logbin.dat
;bin_5_2 = %(KCAP_PATH)s/examples/kv450_data/data_vector/TC_KV450_GALL_reweight_3x3x3_v2_good_xi_e1cor_e2cor_A_tomo_2_5_logbin.dat
;bin_5_3 = %(KCAP_PATH)s/examples/kv450_data/data_vector/TC_KV450_GALL_reweight_3x3x3_v2_good_xi_e1cor_e2cor_A_tomo_3_5_logbin.dat
;bin_5_4 = %(KCAP_PATH)s/examples/kv450_data/data_vector/TC_KV450_GALL_reweight_3x3x3_v2_good_xi_e1cor_e2cor_A_tomo_4_5_logbin.dat
;bin_5_5 = %(KCAP_PATH)s/examples/kv450_data/data_vector/TC_KV450_GALL_reweight_3x3x3_v2_good_xi_e1cor_e2cor_A_tomo_5_5_logbin.dat
cov = %(KCAP_PATH)s/examples/kv450_data/cov/cov_analytic_montepython_mcorr.txt
constant_c_offset = T
xi_pm_c_file = %(KCAP_PATH)s/examples/kv450_data/systematics/KV450_ALL_c12_treecorr.out
like_name = mini_2pt_like
keep_theory_vector = T

[cosebis]
file = %(CSL_PATH)s/cosebis/libcosebis_likelihood.so
theta_min = 0.5
theta_max = 300.0
n_max = 5
input_cosebis_filename = %(KCAP_PATH)s/examples/kv450_data/data_vector/En_20_0.50-300.00_5.bin
input_covariance_filename = %(KCAP_PATH)s/examples/kv450_data/cov/CEnMixed_Th_FromInputNpair_weighted_KV450_20_0.50-300.00_5.ascii
